namespace: ns-system

resources:
  - ../ns-system

patches:
  # バックアップを設定するまでbackupを削除
  - path: backup/mariadb-backup-cron-workflow.yaml
    target:
      kind: CronWorkflow
      name: mariadb-backup-cron
  - path: backup/mariadb-backup-workflow-template.yaml
    target:
      kind: WorkflowTemplate
      name: mariadb-backup
  - path: backup/mongodb-backup-cron-workflow.yaml
    target:
      kind: CronWorkflow
      name: mongodb-backup-cron
  - path: backup/mongodb-backup-workflow-template.yaml
    target:
      kind: WorkflowTemplate
      name: mongodb-backup

  # アプリ用DB
  - path: db/adminer-certificate-patch.yaml
    target:
      kind: Certificate
      name: adminer
  - path: db/adminer-ingress-route-patch.yaml
    target:
      kind: IngressRoute
      name: adminer
  - path: db/mariadb-stateful-set-patch.yaml
    target:
      kind: StatefulSet
      name: mariadb
  - path: db/mongo-stateful-set-patch.yaml
    target:
      kind: StatefulSet
      name: mongo

  # components
  - path: components/builder-deployment-patch.yaml
    target:
      kind: Deployment
      name: ns-builder
  - path: components/certificate-patch.yaml
    target:
      kind: Certificate
      name: ns
  - path: components/ingress-route-patch.yaml
    target:
      kind: IngressRoute
      name: ns
  - path: components/migrate-job-patch.yaml
    target:
      kind: Job
      name: ns-migrate

configMapGenerator:
  - name: ns-config
    behavior: replace
    files:
      - config/ns.yaml

generators:
  - ksops.yaml
