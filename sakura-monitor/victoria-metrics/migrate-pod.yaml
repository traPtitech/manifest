apiVersion: v1
kind: Pod
metadata:
  name: migrate-pod
spec:
  containers:
    - name: debian
      image: debian:stable-slim
      command:
        [
          "/bin/sh",
          "-c",
          "apt-get update && apt-get install -y rsync && rsync -avP /old-data/ /new-data/",
        ]
      volumeMounts:
        - name: old-vol
          mountPath: /old-data
        - name: new-vol
          mountPath: /new-data
  restartPolicy: Never
  nodeSelector:
    kubernetes.io/hostname: sce311.tokyotech.org
  volumes:
    - name: old-vol
      persistentVolumeClaim:
        claimName: storage-victoria-metrics-0
    - name: new-vol
      persistentVolumeClaim:
        claimName: storage-victoria-metrics-longhorn
